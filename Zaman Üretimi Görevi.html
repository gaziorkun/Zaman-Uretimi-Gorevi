<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>ZAMAN ÜRETİMİ GÖREVİ</title>
  <meta name="theme-color" content="#0f172a" />
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #22c55e;
      --brand: #60a5fa;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(180deg, #0b1220 0%, #0f172a 100%);
      color: var(--text);
      min-height: 100dvh;
      display: grid;
      place-items: center;
      padding: 20px;
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: rgba(0,0,0,0);
      touch-action: manipulation;
    }
    .app { width: 100%; max-width: 620px; position: relative; }
    .badge-corner {
      position: absolute;
      right: 6px;
      bottom: -6px;
      transform: translateY(100%);
      font-size: 10.5px;
      color: rgba(203, 213, 225, 0.75);
      white-space: nowrap;
      user-select: none;
    }
    .card {
      background: rgba(17,24,39,0.85);
      border: 1px solid rgba(148,163,184,0.15);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      backdrop-filter: blur(6px);
    }
    .title-badge {
      display: block;
      text-align: center;
      font-size: 1.35rem;
      font-weight: 900;
      letter-spacing: 0.2px;
      padding: 12px 14px;
      border-radius: 14px;
      margin: 2px auto 10px;
      width: 100%;
      color: #eaf3ff;
      background: linear-gradient(180deg, rgba(96,165,250,0.16), rgba(96,165,250,0.06));
      border: 1px solid rgba(96,165,250,0.35);
    }
    p.sub { margin: 0 0 14px; color: var(--muted); font-size: 0.98rem; line-height: 1.35; text-align: center; }

    .targets {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      margin: 12px 0 14px;
    }
    .target {
      background: #0b1220;
      border: 1px solid rgba(148,163,184,0.15);
      border-radius: 12px;
      text-align: center;
      padding: 8px 6px;
      font-weight: 700;
      color: #cbd5e1;
      font-variant-numeric: tabular-nums;
      font-size: 0.95rem;
    }
    .target.done {
      border-color: rgba(34,197,94,0.6);
      color: #dcfce7;
      background: rgba(34,197,94,0.08);
    }
    .bigbtn {
      user-select: none;
      -webkit-user-select: none;
      width: 100%;
      height: 220px;
      border-radius: 18px;
      border: 2px dashed rgba(96,165,250,0.35);
      background: radial-gradient(1200px 240px at 50% 110%, rgba(96,165,250,0.12), transparent 60%);
      display: grid;
      place-items: center;
      color: #dbeafe;
      font-size: 1.05rem;
      padding: 10px;
      text-align: center;
      transition: transform 0.1s ease, border-color 0.2s ease, background 0.2s ease;
      touch-action: none;
      -webkit-tap-highlight-color: rgba(0,0,0,0);
    }
    .bigbtn:active { transform: scale(0.995); }
    .bigbtn.holding {
      border-color: rgba(34,197,94,0.75);
      background: radial-gradient(1200px 240px at 50% 110%, rgba(34,197,94,0.28), transparent 60%);
      color: #eafff1;
    }
    .bigtime { font-size: 2.2rem; font-weight: 800; letter-spacing: 0.5px; font-variant-numeric: tabular-nums; }
    .hint { color: var(--muted); font-size: 0.92rem; }
    .row { display: flex; gap: 10px; align-items: center; justify-content: space-between; margin-top: 12px; flex-wrap: wrap;}
    .btn {
      flex: 1;
      background: #0b1220;
      border: 1px solid rgba(148,163,184,0.2);
      color: #e5e7eb;
      padding: 12px;
      border-radius: 12px;
      font-weight: 700;
      min-width: 140px;
    }
    .btn.primary {
      background: linear-gradient(180deg, rgba(96,165,250,0.2), rgba(96,165,250,0.08));
      border-color: rgba(96,165,250,0.35);
      color: #eaf3ff;
    }
    .editor {
      margin-top: 10px;
      background: rgba(2,6,23,0.35);
      border: 1px solid rgba(148,163,184,0.2);
      padding: 12px;
      border-radius: 12px;
    }
    .editor label { display: block; font-size: 0.9rem; color: #cbd5e1; margin-bottom: 8px; }
    .editor .controls { display: flex; gap: 8px; flex-wrap: wrap; }
    .editor input[type="text"] {
      flex: 1;
      min-width: 240px;
      background: #0b1220;
      border: 1px solid rgba(148,163,184,0.25);
      color: #e5e7eb;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 0.95rem;
    }
    .editor .mini {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.25);
      background: #0b1220;
      color: #e5e7eb;
      font-weight: 700;
    }

    table { width: 100%; border-collapse: collapse; margin-top: 6px; font-variant-numeric: tabular-nums; }
    th, td { text-align: left; padding: 10px; border-bottom: 1px solid rgba(148,163,184,0.15); }
    th { color: #cbd5e1; font-weight: 700; }
    td small { color: var(--muted); }
    .footer { text-align: center; color: var(--muted); font-size: 0.85rem; margin-top: 14px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <span class="title-badge">🕒 ZAMAN ÜRETİMİ GÖREVİ</span>

      <p class="sub">Bu uygulamada ekranda yazan süreleri ekrana basılı tutarak üretmeniz istenmektedir. Bu uygulamanın amacı zaman algısı üzerine bilimsel çalışma yapabilmektir.</p>

      <div class="targets" id="targets"></div>

      <button id="holdBtn" class="bigbtn" aria-label="Basılı Tut">
        <div>
          <div class="bigtime" id="currentTarget">—</div>
          <div class="hint" id="hint">Başlamak için basılı tut.</div>
        </div>
      </button>

      <div class="row">
        <button class="btn" id="edit">⚙️ Hedefleri Düzenle</button>
        <button class="btn" id="skip">↪️ Sıradakine Geç</button>
        <button class="btn primary" id="reset">🔄 Yeniden Başlat</button>
      </div>

      <div id="editor" class="editor hidden">
        <label>Görev süreleri (saniye) — virgülle ayır: <small style="color:#94a3b8">Örn: 1, 3, 6, 12, 15</small></label>
        <div class="controls">
          <input id="durationsInput" type="text" value="1, 3, 6, 12, 15" inputmode="decimal" />
          <button class="mini" id="apply">Uygula</button>
          <button class="mini" id="closeEditor">Kapat</button>
        </div>
      </div>

      <div id="results" class="hidden">
        <h2 style="margin:16px 0 6px;font-size:1.05rem;">Sonuçlar</h2>
        <table>
          <thead>
            <tr>
              <th>Hedef (sn)</th>
              <th>Ölçülen (sn)</th>
              <th>Bağıl Hata</th>
              <th>Mutlak Hata</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
        <div class="footer">Her <strong>Yeniden Başlat</strong>’ta hedefler rastgele sırayla gelir.</div>
      </div>
    </div>

    <div class="badge-corner">Çukurova Üniversitesi Ruh Sağlığı ve Hastalıkları Anabilim Dalı</div>
  </div>

  <script>
    (function () {
      // Block iOS long-press menus and zoom gestures
      document.addEventListener('contextmenu', function(e){ e.preventDefault(); }, {passive:false});
      window.addEventListener('gesturestart', function(e){ e.preventDefault(); }, {passive:false});

      // Base (user-editable) targets in seconds
      let baseTargetsSec = [1, 3, 6, 12, 15];
      // Current session randomized order
      let currentTargetsSec = [];
      // Measurement state
      let index = 0;
      let holding = false;
      let startTime = 0;
      let measuredMs = [];

      // Elements
      const elTargets = document.getElementById('targets');
      const elHoldBtn = document.getElementById('holdBtn');
      const elCurrentTarget = document.getElementById('currentTarget');
      const elHint = document.getElementById('hint');
      const elSkip = document.getElementById('skip');
      const elReset = document.getElementById('reset');
      const elResults = document.getElementById('results');
      const elTbody = document.getElementById('tbody');
      const elEdit = document.getElementById('edit');
      const elEditor = document.getElementById('editor');
      const elDurationsInput = document.getElementById('durationsInput');
      const elApply = document.getElementById('apply');
      const elCloseEditor = document.getElementById('closeEditor');

      // Utils
      function shuffle(arr) {
        const a = arr.slice();
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }
      function fmtSecFixed(sec) {
        return sec.toLocaleString('tr-TR', { minimumFractionDigits: 4, maximumFractionDigits: 4 });
      }
      function fmtSecCompact(sec) {
        return sec.toLocaleString('tr-TR', { minimumFractionDigits: 0, maximumFractionDigits: 4 });
      }
      function parseDurationsInput(text) {
        const parts = text.split(/[,;]+|\s+/).map(s => s.trim()).filter(Boolean);
        const out = [];
        for (let p of parts) {
          p = p.replace(',', '.');
          const v = Number(p);
          if (!isFinite(v) || v <= 0) continue;
          out.push(v);
        }
        return out;
      }

      // Render
      function renderTargets() {
        elTargets.innerHTML = '';
        currentTargetsSec.forEach((t, i) => {
          const div = document.createElement('div');
          div.className = 'target' + (measuredMs[i] != null ? ' done' : '');
          div.textContent = fmtSecCompact(t) + ' sn';
          elTargets.appendChild(div);
        });
      }
      function renderHeader() {
        if (index >= currentTargetsSec.length) {
          elCurrentTarget.textContent = 'Bitti!';
          elHint.textContent = 'Sonuçlara aşağıdan bakabilirsin.';
          elHoldBtn.disabled = true;
          elHoldBtn.classList.remove('holding');
          return;
        }
        elCurrentTarget.textContent = fmtSecCompact(currentTargetsSec[index]) + ' sn';
        elHint.textContent = holding ? 'Bırakınca kaydedilecek…' : 'Başlamak için basılı tut.';
      }
      function showResults() {
        elResults.classList.remove('hidden');
        elTbody.innerHTML = '';
        for (let i = 0; i < currentTargetsSec.length; i++) {
          const t = currentTargetsSec[i];
          const m_ms = measuredMs[i];
          const tr = document.createElement('tr');
          if (m_ms == null) {
            tr.innerHTML = `<td>${fmtSecCompact(t)} sn</td><td>—</td><td>—</td><td>—</td>`;
          } else {
            const m_sec = m_ms / 1000;
            const rel = m_sec / t; // Bağıl Hata
            const absErr = Math.abs((m_sec - t) / t); // Mutlak Hata
            tr.innerHTML = `
              <td>${fmtSecCompact(t)} sn</td>
              <td>${fmtSecFixed(m_sec)} sn</td>
              <td>${rel.toLocaleString('tr-TR', { minimumFractionDigits: 4, maximumFractionDigits: 4 })}</td>
              <td>${absErr.toLocaleString('tr-TR', { minimumFractionDigits: 4, maximumFractionDigits: 4 })}</td>
            `;
          }
          elTbody.appendChild(tr);
        }
      }
      function finishIfDone() {
        const done = measuredMs.every(v => v != null);
        if (done) showResults();
      }

      // Actions
      function startHold(e) {
        if (index >= currentTargetsSec.length) return;
        holding = true;
        startTime = performance.now();
        elHoldBtn.classList.add('holding');
        renderHeader();
        if (e && e.cancelable) e.preventDefault();
      }
      function endHold(e) {
        if (!holding || index >= currentTargetsSec.length) return;
        holding = false;
        elHoldBtn.classList.remove('holding');
        const elapsed = performance.now() - startTime;
        measuredMs[index] = elapsed;
        index++;
        renderTargets();
        renderHeader();
        finishIfDone();
        if (e && e.cancelable) e.preventDefault();
      }
      function skip() {
        if (index >= currentTargetsSec.length) return;
        measuredMs[index] = 0;
        index++;
        renderTargets();
        renderHeader();
        finishIfDone();
      }
      function reset(randomize = true) {
        index = 0;
        holding = false;
        measuredMs = new Array(baseTargetsSec.length).fill(null);
        currentTargetsSec = randomize ? shuffle(baseTargetsSec) : baseTargetsSec.slice();
        elResults.classList.add('hidden');
        elHoldBtn.disabled = false;
        elHoldBtn.classList.remove('holding');
        renderTargets();
        renderHeader();
      }
      function toggleEditor() {
        elEditor.classList.toggle('hidden');
      }
      function applyDurations() {
        const parsed = parseDurationsInput(elDurationsInput.value);
        if (parsed.length === 0) {
          alert('Geçerli süreler girin (örn: 1, 3, 6, 12, 15).');
          return;
        }
        baseTargetsSec = parsed;
        reset(true);
      }

      // Pointer + Touch listeners (robust on iOS)
      elHoldBtn.addEventListener('pointerdown', startHold);
      elHoldBtn.addEventListener('pointerup', endHold);
      elHoldBtn.addEventListener('pointercancel', endHold);
      elHoldBtn.addEventListener('pointerleave', () => { if (holding) endHold(); });

      // Fallback explicit touch events for older iOS/Safari behaviors
      elHoldBtn.addEventListener('touchstart', startHold, {passive:false});
      elHoldBtn.addEventListener('touchend', endHold, {passive:false});
      elHoldBtn.addEventListener('touchcancel', endHold, {passive:false});

      elSkip.addEventListener('click', skip);
      elReset.addEventListener('click', () => reset(true));
      elEdit.addEventListener('click', toggleEditor);
      elApply.addEventListener('click', applyDurations);
      elCloseEditor.addEventListener('click', toggleEditor);

      // First load randomized
      reset(true);
    })();
  </script>
</body>
</html>
